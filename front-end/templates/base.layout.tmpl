{{define "base"}}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NYC Capital Projects AI Agent</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    #chat-container { max-width: 700px; margin: auto; height: 70vh; overflow-y: auto; padding: 1rem; border: 1px solid #ccc; border-radius: 10px; background-color: #fff; display: flex; flex-direction: column; gap: 0.5rem; }
    .chat-row { display: flex; align-items: flex-start; gap: 0.5rem; }
    .chat-row.user { justify-content: flex-end; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #fff; }
    .user-avatar { background-color: #007bff; }
    .ai-avatar { background-color: #6c757d; }
    .message { padding: 0.5rem 1rem; border-radius: 15px; max-width: 70%; position: relative; }
    .user-message { background-color: #007bff; color: #fff; }
    .ai-message { background-color: #e9ecef; color: #000; }
    .timestamp { font-size: 0.7rem; color: #6c757d; margin-top: 0.2rem; text-align: right; }
    #input-area { max-width: 700px; margin: 1rem auto; display: flex; gap: 0.5rem; }
    #question { flex: 1; resize: none; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="text-center mb-4">NYC Capital Projects AI Agent</h1>

    <div id="chat-container"></div>

    <div id="input-area">
      <textarea id="question" class="form-control" rows="2" placeholder="Type your question..."></textarea>
      <button id="submit" class="btn btn-primary">Send</button>
    </div>

    <div class="text-center text-muted">
      âš¡ Note: Since the AI agent runs locally, responses may take a few seconds.
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const chatContainer = document.getElementById('chat-container');
    const questionInput = document.getElementById('question');
    const submitButton = document.getElementById('submit');

    function addMessage(text, type, timestamp = null) {
      const row = document.createElement('div');
      row.className = `chat-row ${type === 'user-message' ? 'user' : ''}`;

      const avatar = document.createElement('div');
      avatar.className = `avatar ${type === 'user-message' ? 'user-avatar' : 'ai-avatar'}`;
      avatar.innerHTML = type === 'user-message' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';

      const msg = document.createElement('div');
      msg.className = `message ${type}`;
      msg.innerHTML = `<div>${text}</div>`;

      const ts = document.createElement('div');
      ts.className = 'timestamp';
      ts.innerText = timestamp || new Date().toLocaleTimeString();
      msg.appendChild(ts);

      if (type === 'user-message') {
        row.appendChild(msg);
        row.appendChild(avatar);
      } else {
        row.appendChild(avatar);
        row.appendChild(msg);
      }

      chatContainer.appendChild(row);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

   
    async function sendQuestion() {
      const question = questionInput.value.trim();
      if (!question) return;

     
      questionInput.disabled = true;
      submitButton.disabled = true;

      addMessage(question, 'user-message');
      questionInput.value = '';

      //Waint for message message
      addMessage('AI is typing... <span class="spinner-border spinner-border-sm" role="status"></span>', 'ai-message');
      const thinkingMsg = chatContainer.querySelector('.ai-message:last-child .message');

      try {
        const res = await fetch('http://localhost:5000/ask', { 
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });
        const data = await res.json();
        const answer = data.answer || 'No answer returned.';

      
        if (thinkingMsg) thinkingMsg.innerHTML = '';
        let i = 0;
        const interval = setInterval(() => {
          if (thinkingMsg) thinkingMsg.innerHTML = `<div>${answer.substring(0, i)}</div>`;
          i++;
          if (i > answer.length) clearInterval(interval);
        }, 20);
      } catch (err) {
        if (thinkingMsg) thinkingMsg.innerText = 'Error: ' + err.message;
      } finally {
        questionInput.disabled = false;
        submitButton.disabled = false;
        questionInput.focus();
      }
    }

    
    submitButton.onclick = sendQuestion;
    questionInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendQuestion();
      }
    });

    
    window.onload = () => {
        addMessage("Hi! Iâ€™m your NYC Capital Projects AI Agent ðŸ¤–. Ask me about projects from 2023 to 2025!", 'ai-message');    };
  </script>
</body>
</html>


{{end}}